<h2 id="marker-api">Marker API</h2>

<p><code>Path: ./app/controllers/marker_controller.rb</code></p>

<ul>
  <li>Get markers
```sh
Method: get_markers
Route: GET http://localhost:3000/marker/get_markers
Params: locationLat, locationLng, radius[, markerType, markerCategory]</li>
  <li>Optional params to pagination: page, [ limit(default:1)]</li>
  <li>Optional params to sector select: direction, angle</li>
  <li>
    <p>Optional params to name filter: looklike (trái|phải|tốc độ)
Success:
{
  “success”: true,
  “markers”: [
      {
          “description”: {
              “address”: “Huyện Quảng Ninh, Quảng Bình”,
              “district”: “Huyện Quảng Ninh”,
              “info_review”: “PHONE() FAX() WEBSITE() MAIL()”,
              “number”: null,
              “province”: “Quảng Bình”,
              “street”: null
          },
          “dislike_count”: 0,
          “expired_at”: null,
          “geo_near_distance”: 4.000355602329364e-9,
          “like_count”: 449,
          “lng_lat”: [
              106.69686404244,
              17.3425737605719
          ],
          “name”: “Cây xăng”,
          “published_at”: “2015-01-12T12:45:44.949+07:00”,
          “marker_type”: {
              “code”: “XD”,
              “description”: null,
              “enable_dislike”: true,
              “name”: “Cây xăng”
          },
          “_id”: “54b35f88676f6e67a2000000”,
          “marker_type_id”: “5497f0a1676f6e0571180000”,
          “user_id”: “549cd708676f6e03a7000000”
      },
      {
          “description”: {
              “address”: “Huyện Quảng Ninh, Quảng Bình”,
              “district”: null,
              “info_review”: null,
              “number”: null,
              “province”: null,
              “street”: null
          },
          “dislike_count”: 0,
          “expired_at”: null,
          “geo_near_distance”: 1.2922972364278158,
          “like_count”: 5,
          “lng_lat”: [
              106.703218419095,
              17.3313209781806
          ],
          “name”: “Trung tâm Y tế Gia Ninh”,
          “published_at”: “2014-12-22T17:25:08.862+07:00”,
          “marker_type”: {
              “code”: “BV”,
              “description”: null,
              “enable_dislike”: false,
              “name”: “Nhà thuốc, bệnh viện, cơ sở y tế”
          },
          “_id”: “5497f184676f6e06241b1500”,
          “marker_type_id”: “5497f0a1676f6e0571170000”,
          “user_id”: “5497f0c0676f6e05a1000000”
      }
  ]
}
```</p>
  </li>
  <li>Within box
```sh
Method: within_box
Route: GET http://localhost:3000/marker/within_box
Params: locationLat(Max/Min), locationLng(Max/Min)</li>
  <li>Optional params to filter: markerType, markerCategory</li>
  <li>Optional params to pagination: page, [ limit(default:1)]</li>
  <li>
    <p>Optional params to name filter: looklike (trái|phải|tốc độ)
Success:
{
  “success”: true,
  “markers”: [
      {
          “description”: {
              “address”: “Tỉnh lộ 334, Huyện Vân Đồn, Quảng Ninh”,
              “district”: null,
              “info_review”: null,
              “number”: null,
              “province”: null,
              “street”: null
          },
          “dislike_count”: 0,
          “expired_at”: null,
          “like_count”: 38,
          “lng_lat”: [
              107.442814541258,
              21.0867587259344
          ],
          “name”: “Trạm Y tế xã Hạ Long”,
          “published_at”: “2014-12-22T17:25:21.897+07:00”,
          “marker_type”: {
              “code”: “BV”,
              “description”: null,
              “enable_dislike”: false,
              “name”: “Nhà thuốc, bệnh viện, cơ sở y tế”
          },
          “_id”: “5497f191676f6e0624971c00”,
          “marker_type_id”: “5497f0a1676f6e0571170000”,
          “user_id”: “5497f0c0676f6e05a1000000”
      },
      {
          “description”: {
              “address”: “Huyện Cô Tô, Quảng Ninh”,
              “district”: null,
              “info_review”: null,
              “number”: null,
              “province”: null,
              “street”: null
          },
          “dislike_count”: 0,
          “expired_at”: null,
          “like_count”: 189,
          “lng_lat”: [
              107.753458317447,
              20.9892930867066
          ],
          “name”: “Trạm Y tế xã Đồng Tiến”,
          “published_at”: “2014-12-22T17:25:58.720+07:00”,
          “marker_type”: {
              “code”: “BV”,
              “description”: null,
              “enable_dislike”: false,
              “name”: “Nhà thuốc, bệnh viện, cơ sở y tế”
          },
          “_id”: “5497f1b6676f6e0624c42f00”,
          “marker_type_id”: “5497f0a1676f6e0571170000”,
          “user_id”: “5497f0c0676f6e05a1000000”
      }
  ]
}
```</p>
  </li>
  <li>
    <p>Set marker
<code>sh
Method: set_marker
Route: POST http://localhost:3000/marker/set_marker
Params: name, locationLng, locationLat, markerType,
      description_addess, description_info_review, description_number....
      image_avatar, image_slide
Location not shared yet:
{
  "success": true,
  "message": "Cảm ơn bạn đã chia sẻ, địa điểm đã được duyệt tự động, +3 điểm !"
}
Location is shared yet, get bonus share:
{
  "success": true,
  "message": "Địa điểm này đã có người chia sẻ, bạn được +1 điểm"
}
</code></p>
  </li>
  <li>
    <p>Get marker detail
<code>sh
Method: get_marker_detail
Route: GET http://localhost:3000/marker/get_marker_detail
Params: id
Success:
{
  "success": true,
  "data": {
      "_id": "5497ed005468615b4cbb4d00",
      "created_at": "2014-12-22T17:05:52.249+07:00",
      "description": {
          "_id": {
              "$oid": "5497ed005468615b4cbc4d00"
          },
          "address": "3 Lý Thái Tổ, Thành phố Lạng Sơn, Lạng Sơn",
          "district": null,
          "info_review": null,
          "number": null,
          "province": null,
          "street": null
      },
      "like_count": 249,
      "lng_lat": [
          106.761781989247,
          21.8458173238104
      ],
      "marker_type_id": "5497ec2a5468615b3d150000",
      "name": "ATM Agribank",
      "star_point": 3,
      "status": "ACCEPT",
      "updated_at": "2014-12-22T17:05:52.249+07:00",
      "user_id": "5497ec1a5468615b38000000"
  },
  "created_by": {
      "avatar": "5497ec1a5468615b38000000.jpg",
      "full_name": null,
      "username": "root",
      "_id": "5497ec1a5468615b38000000"
  },
  "comments": [
      {
          "content": "dddd",
          "created_at": "2014-12-26T11:23:30.021+07:00",
          "user": {
              "avatar": null,
              "created_at": "2014-12-26T11:15:35.480+07:00",
              "full_name": "name_4",
              "username": "user_4"
          },
          "_id": "549ce2c254686108b4010000",
          "marker_id": "5497ec955468615b4c551500",
          "user_id": "549ce0e7546861088a050000"
      }
  ],
  "likes": [
      {
          "_id": {
              "$oid": "549ce0e7546861088a050000"
          },
          "avatar": null,
          "full_name": "name_4",
          "username": "user_4"
      }
  ],
  "reports": [
      {
          "created_at": "2014-12-26T14:22:45.426+07:00",
          "processed": false,
          "report_type": {
              "code": "EMPTY",
              "created_at": "2014-12-24T14:49:35.969+07:00",
              "name": "Không tồn tại"
          },
          "user": {
              "avatar": "5497ec1a5468615b38000000.jpg",
              "created_at": "2014-12-22T17:02:02.585+07:00",
              "full_name": null,
              "username": "root"
          },
          "_id": "549d0ca55468610dc1010000",
          "report_type_id": "549a700f5468611126000000",
          "marker_id": "5497ec955468615b4c551500",
          "user_id": "5497ec1a5468615b38000000"
      }
  ],
  "liked": true
}
</code></p>
  </li>
  <li>
    <p>Like toggle
<code>sh
Method: like_toggle
Route: POST http://localhost:3000/marker/like_toggle
Params: id
Success:
{
  "message": "Success",
  "liked": true,
  "success": true
}
</code></p>
  </li>
  <li>
    <p>Dislike toggle
<code>sh
Method: dislike_toggle
Route: POST http://localhost:3000/marker/dislike_toggle
Params: id, comment
Success:
{
  "message": "Success",
  "disliked": true,
  "success": true
}
</code></p>
  </li>
  <li>Report
```sh
Method: report
Route: POST http://localhost:3000/marker/report
Params: type, id (type in [‘EMPTY’, ‘REMOVE’])</li>
  <li>Optional params: new_name (required for type:NWRONG)</li>
  <li>Optional params: new_lat, new_lng (required for type:PWRONG),
                 description_addess, description_info_review, description_number….</li>
  <li>
    <p>Optional params: new_speed (required for type:SWRONG)
Success:
{
 “success”: true,
 “Message”:”Success”
}
```</p>
  </li>
  <li>
    <p>Get Reports
<code>sh
Method: get_reports
Route: GET http://localhost:3000/marker/get_reports
Params: id (marker_id)
Success:
{
  "success": true,
  "reports": [
      {
          "_id": "5477fd4b546861099f130000",
          "created_at": "2014-11-28T04:42:51.525Z",
          "marker_change": {
              "_id": {
                  "$oid": "5477fd4b546861099f140000"
              },
              "lng_lat": null,
              "name": null
          },
          "marker_id": "5477fd4b546861099f0c0000",
          "processed": false,
          "report_type_id": "5477fd4b546861099f060000",
          "updated_at": "2014-11-28T04:42:51.525Z",
          "user_id": "5477fd4b546861099f020000"
      }
  ]
}
</code></p>
  </li>
  <li>
    <p>Get Comments
<code>sh
Method: get_comments
Route: GET http://localhost:3000/marker/get_comments
Params: id (marker_id)
Success:
{
  "success": true,
  "comments": [
      {
          "_id": "5477ef96546861076f0d0000",
          "content": "this is comment #1 from user: name_2",
          "marker_id": "5477ef96546861076f0c0000",
          "user_id": "5477ef96546861076f030000"
      },
      {
          "_id": "5477ef96546861076f100000",
          "content": "this is comment #2 from user: name_1",
          "marker_id": "5477ef96546861076f0c0000",
          "user_id": "5477ef96546861076f020000"
      }
  ]
}
</code></p>
  </li>
  <li>Add Comment
<code>sh
Method: add_comment
Route: POST http://localhost:3000/marker/comment
Params: marker_id, content
Success:
{
  "success": true,
  "message": "Bạn vừa mới bình luận thành công",
  "comment": {
      "_id": "5493d8c454686121f4010000",
      "content": "hello, comment",
      "created_at": "2014-12-19T14:50:28.364+07:00",
      "marker_id": "5486ca4154686177c40c0000",
      "updated_at": "2014-12-19T14:50:28.364+07:00",
      "user_id": "5486ca4154686177c4000000"
  }
}
</code></li>
</ul>
